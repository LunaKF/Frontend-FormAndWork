<div class="page soft-bg">
  <!-- Header -->
  <header class="header-ofertas">
    <div class="container-xl">
      <div class="toolbar">
        <div class="title-group">
          <h1 class="title-gradient">
            Ofertas • <span class="sector-nombre">{{ oSector?.nombre }}</span>
          </h1>
          <p class="subtitle">Explora las ofertas de este sector.</p>
        </div>

        <div class="tools">
          <div class="searchbox">
            <i class="bi bi-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Buscar por título, empresa o descripción…"
              [(ngModel)]="strFiltro"
              (keyup)="filter()"
              aria-label="Buscar ofertas"
            />
          </div>

          <div class="btn-group rpp-pills" role="group" aria-label="Resultados por página">
            <button type="button" class="btn" [class.active]="nRpp === 10"  (click)="goToRpp(10)">10</button>
            <button type="button" class="btn" [class.active]="nRpp === 50"  (click)="goToRpp(50)">50</button>
            <button type="button" class="btn" [class.active]="nRpp === 100" (click)="goToRpp(100)">100</button>
          </div>
        </div>

        <!-- Chips -->
        <div class="chips">
          <span class="chip" [class.chip-muted]="!(strFiltro.length>0)">
            <i class="bi bi-funnel"></i>
            @if (strFiltro.length>0) { Filtro: <strong class="text-danger">{{ strFiltro }}</strong> } @else { Sin filtro }
          </span>

          <span class="chip">
            <i class="bi bi-collection"></i>
            Mostrando {{ oPage?.numberOfElements || 0 | number:'1.0-0' }}
            de {{ oPage?.totalElements || 0 | number:'1.0-0' }}
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido -->
  <section class="table-section">
    <div class="container-xl">
      <div class="card shadow-xl rounded-4 overflow-hidden">
        <div class="table-wrapper p-4">

          <!-- Skeleton -->
          <div *ngIf="loading">
            <div class="sk-line"></div><div class="sk-line"></div><div class="sk-line"></div>
          </div>

          <!-- Tabla -->
          <div class="table-responsive" *ngIf="!loading">
            <table class="table table-separated align-middle text-center table-ofertas mb-0">
              <thead class="table-header">
                <tr>
                  <th *ngIf="isAdmin" class="min-col">ID</th>
                  <th>Título</th>
                  <th class="descripcion-col">Descripción</th>
                  <th>Empresa</th>
                  <th *ngIf="isAdmin" class="min-col">Acciones</th>
                </tr>
              </thead>

              <tbody>
                @for (oferta of oPage?.content; track oferta.id) {
                  <tr class="row-card hover-rise">
                    <td *ngIf="isAdmin" class="idContent">{{ oferta.id }}</td>

                    <td class="text-start fw-semibold">
                      {{ oferta.titulo | trim: 40 }}
                    </td>

                    <td class="text-start descripcion-cell">
                      {{ oferta.descripcion | trim: 160 }}
                    </td>

                    <td class="text-start">
                      {{ oferta.empresa.nombre | trim: 40 }}
                    </td>

                    <td *ngIf="isAdmin">
                      <div class="d-flex gap-2 justify-content-center">
                        <button type="button" class="btn-icon lift" (click)="view(oferta)"  aria-label="Ver"><i class="bi bi-eye"></i></button>
                        <button type="button" class="btn-icon lift" (click)="edit(oferta)"  aria-label="Editar"><i class="bi bi-pen"></i></button>
                        <button type="button" class="btn-icon lift btn-danger-soft" (click)="remove(oferta)" aria-label="Eliminar"><i class="bi bi-trash"></i></button>
                      </div>
                    </td>
                  </tr>
                } @empty {
                  <tr>
                    <td [attr.colspan]="isAdmin ? 5 : 3" class="text-center py-5 text-muted">No hay ofertas</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          <!-- Paginación -->
          <nav class="my-3" aria-label="Paginación" *ngIf="hasMultiplePages()">
            <ul class="pagination justify-content-center flex-wrap gap-1">
              <li class="page-item" [class.disabled]="(nPage + 1) === 1">
                <a class="page-link" href="#" (click)="goToPrev()"><i class="bi bi-caret-left-square-fill"></i></a>
              </li>

              <li class="page-item" *ngFor="let pag of arrBotonera">
                @if (pag === '...') {
                  <span class="page-link">{{ pag }}</span>
                } @else {
                  <a class="page-link" href="#" (click)="goToPage(+pag)" [class.active]="(nPage + 1) === +pag">{{ pag }}</a>
                }
              </li>

              <li class="page-item" [class.disabled]="(nPage + 1) === (oPage?.totalPages || 0)">
                <a class="page-link" href="#" (click)="goToNext()"><i class="bi bi-caret-right-square-fill"></i></a>
              </li>
            </ul>
          </nav>

        </div>
      </div>
    </div>
  </section>
</div>
