<div class="container fw-wrap">
  <!-- Toolbar -->
  <div class="fw-head">
    <div>
      @if (isAdmin) {
        <a class="fw-btn" [routerLink]="'/admin/alumno/create'">
          <i class="bi bi-plus-square"></i> Crear alumno
        </a>
      }
    </div>

    <h2 class="fw-title">
      <i class="bi bi-list"></i> Lista de Alumnos
    </h2>

    <div class="fw-controls">
      <div class="fw-search">
        <i class="bi bi-search"></i>
        <input
          type="text"
          class="form-control"
          placeholder="Buscar alumnos..."
          (keyup)="filter($event)"
          [(ngModel)]="strFiltro"
        />
      </div>
      <div class="fw-rpp" aria-label="Resultados por página">
        <span class="fw-chip" [class.active]="nRpp===12" (click)="goToRpp(12)">12</span>
        <span class="fw-chip" [class.active]="nRpp===24" (click)="goToRpp(24)">24</span>
        <span class="fw-chip" [class.active]="nRpp===36" (click)="goToRpp(36)">36</span>
      </div>
    </div>
  </div>

  <div class="fw-meta">
    <div>
      @if (strFiltro.length > 0) {
        Filtrado por: <span class="highlight">{{ strFiltro }}</span>
      } @else {
        Sin filtrar
      }
    </div>
    <div>
      Mostrando {{ oPage?.numberOfElements | number:'1.0-0' }}
      de {{ oPage?.totalElements | number:'1.0-0' }}
    </div>
  </div>

  <!-- GRID -->
  <div class="fw-grid">
    @for (alumno of (oPage?.content ?? []); track alumno.id) {
      <div class="fw-col">
        <!-- TARJETA CLICABLE -->
        <article
          class="fw-card"
          tabindex="0"
          (click)="view(alumno)"
          (keydown.enter)="view(alumno)"
          [attr.aria-label]="'Abrir detalle de ' + (alumno?.nombre || '')"
        >
          <img src="img/PerfilUsuario.jpg" alt="Perfil" class="corner-img" />

          <div class="fw-card-body">
            <h5 class="fw-name">{{ alumno.nombre }} {{ alumno.ape1 }} {{ alumno.ape2 }}</h5>

            <p class="fw-field"><strong>Email:</strong> {{ alumno.email }}</p>

            <p class="fw-field">
              <strong>Sector:</strong>
              <span class="fw-tag">{{ alumno.sector?.nombre || '—' }}</span>
            </p>

            <div class="d-flex justify-content-between align-items-center gap-2 mt-2">
              <!-- Postulaciones -->
              <a
                class="fw-ghost"
                [routerLink]="'/admin/candidatura/xalumno/plist/' + alumno.id"
                (click)="$event.stopPropagation()"
              >
                <span class="fw-count">{{ alumno.candidaturas || 0 }}</span>
                Postulaciones
                <i class="bi bi-arrow-up-right-square"></i>
              </a>

              <!-- Acciones -->
              <div class="fw-actions">
                @if (isAdmin) {
                  <button
                    type="button"
                    class="fw-iconbtn edit"
                    title="Editar"
                    (click)="$event.stopPropagation(); edit(alumno)"
                  >
                    <i class="bi bi-pen"></i>
                  </button>
                  <button
                    type="button"
                    class="fw-iconbtn del"
                    title="Eliminar"
                    (click)="$event.stopPropagation(); remove(alumno)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                }
              </div>
            </div>
          </div>
        </article>
      </div>
    } @empty {
      <div class="fw-col">
        <div class="fw-empty">No hay alumnos</div>
      </div>
    }
  </div>

  <!-- PAGINACIÓN -->
  <nav class="fw-pager" aria-label="Paginación">
    <span class="fw-page" [class.disabled]="nPage - -1 === 1" (click)="goToPrev()">
      <i class="bi bi-caret-left-square-fill"></i> Anterior
    </span>

    <ng-container *ngFor="let pag of arrBotonera">
      @if (pag==='...') {
        <span class="fw-page disabled">...</span>
      } @else {
        <span class="fw-page" [class.active]="nPage - -1 === -(-pag)" (click)="goToPage(-(-pag))">
          {{ pag }}
        </span>
      }
    </ng-container>

    <span class="fw-page" [class.disabled]="nPage - -1 === oPage?.totalPages" (click)="goToNext()">
      Siguiente <i class="bi bi-caret-right-square-fill"></i>
    </span>
  </nav>
</div>
