<div class="alumno-page">

  <!-- BANNER ROL ARRIBA DEL TODO -->
  <div class="role-banner" *ngIf="canAdmin">
    <div class="container-xl role-banner-inner">
      <span class="role-chip">
        <i class="bi bi-shield-lock"></i>
        Modo administración activo
      </span>
      <span class="role-text">
        Estás gestionando el alumnado de este sector. Accede a edición y borrado con cuidado.
      </span>
    </div>
  </div>

  <!-- HERO -->
  <section class="alumno-hero">
    <div class="alumno-hero-overlay"></div>

    <div class="container-xl alumno-hero-inner">
      <h1 class="alumno-title">
        Alumnos del sector {{ oSector?.nombre || '—' }}
      </h1>

      <p class="alumno-subtitle">
        Aquí puedes consultar el alumnado que pertenece a este sector.
        @if (canAdmin) {
        También puedes gestionarlo desde este panel.
        } @else {
        Esta vista es solo de consulta.
        }
      </p>

      <div class="alumno-roles">
        <span class="role-pill soft" *ngIf="isEmpresa">
          <i class="bi bi-building"></i>
          Vista para empresa
        </span>
        <span class="role-pill soft" *ngIf="isAlumno">
          <i class="bi bi-mortarboard"></i>
          Vista para alumnado
        </span>
      </div>
    </div>
  </section>

  <!-- TOOLBAR -->
  <section class="alumno-toolbar">
    <div class="container-xl">
      <div class="toolbar-card">

        <div class="toolbar-left">
          <div class="searchbox">
            <i class="bi bi-search"></i>
            <input type="text" class="form-control" placeholder="Buscar por nombre, apellidos, email, ID o sector…"
              [(ngModel)]="query" (input)="filter()" aria-label="Buscar alumnos" />
          </div>

          <div class="chips">
            <span class="chip" [class.chip-muted]="!(query.length>0)">
              <i class="bi bi-funnel"></i>
              @if (query.length>0) {
              Filtro: <strong>{{ query }}</strong>
              } @else {
              Sin filtro activo
              }
            </span>

            <span class="chip" *ngIf="oPage">
              <i class="bi bi-collection"></i>
              {{ filteredAlumnos.length }} de {{ oPage.totalElements }} alumnos
            </span>
          </div>
        </div>

        <div class="toolbar-right">
          <div class="rpp-pills" aria-label="Resultados por página">
            <button type="button" class="pill-rpp" [class.active]="nRpp === 12" (click)="goToRpp(12)">12</button>
            <button type="button" class="pill-rpp" [class.active]="nRpp === 24" (click)="goToRpp(24)">24</button>
            <button type="button" class="pill-rpp" [class.active]="nRpp === 36" (click)="goToRpp(36)">36</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- GRID -->
  <section class="alumno-grid">
    <div class="container-xl">
      <div class="grid">

        <!-- Skeleton -->
        <ng-container *ngIf="loading">
          <article class="student-card skeleton" *ngFor="let i of [1,2,3,4,5,6]">
            <div class="card-main">
              <div class="avatar-img sk"></div>
              <div class="info">
                <div class="sk-line"></div>
                <div class="sk-line short"></div>
              </div>
            </div>
          </article>
        </ng-container>

        <!-- Cards -->
        <article class="student-card" *ngFor="let alumno of filteredAlumnos; trackBy: trackById" tabindex="0"
          (click)="onCardClick(alumno)" (keydown.enter)="onCardClick(alumno)" [class.clickable]="canOpenView">
          <div class="card-main">
            <!-- Avatar con imagen -->
            <div class="avatar-img" aria-hidden="true">
              <img src="img/PerfilUsuario.jpg" alt="Perfil del alumno" loading="lazy" />
            </div>

            <div class="info">
              <div class="title-row">
                <h2 class="student-name">{{ fullName(alumno) }}</h2>
                <span *ngIf="canAdmin" class="student-id">#{{ alumno.id }}</span>
              </div>

              <div class="sector-line">
                <i class="bi bi-diagram-3"></i>
                <span class="sector-text">
                  {{ oSector?.nombre || alumno.sector?.nombre || 'Sector sin asignar' }}
                </span>
              </div>

              <div class="email" *ngIf="canAdmin">
                <i class="bi bi-envelope"></i>
                {{ alumno.email || '—' }}
              </div>
            </div>
          </div>

          <div class="card-footer">
            <!-- Candidaturas (igual filosofía que tu plist general: solo admin) -->
            <button type="button" class="btn candidaturas" *ngIf="canAdmin"
              (click)="onCandidaturasClick(alumno, $event)">
              <i class="bi bi-send-check"></i>
              <span>
                {{ getCandidaturasCount(alumno) }} candidaturas
              </span>
            </button>

            <!-- Si no es admin, dejamos un “pill” neutro para que el footer no quede raro -->
            <span class="hint" *ngIf="!canAdmin">
              <i class="bi bi-person-badge"></i>
              Perfil de alumno
            </span>

            <!-- Acciones admin -->
            <div class="actions" *ngIf="canAdmin">
              <button class="btn" type="button" (click)="$event.stopPropagation(); edit(alumno)">
                <i class="bi bi-pen"></i> Editar
              </button>

              <button class="btn danger" type="button" (click)="$event.stopPropagation(); remove(alumno)">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </article>

        <!-- Vacío -->
        <div class="empty" *ngIf="!loading && filteredAlumnos.length === 0">
          <i class="bi bi-emoji-neutral"></i>
          <p>No hay alumnos que coincidan con la búsqueda.</p>
        </div>

      </div>

      <!-- Paginación -->
      <nav class="my-3" aria-label="Paginación" *ngIf="hasMultiplePages()">
        <ul class="pagination justify-content-center flex-wrap">

          <li class="page-item" [class.disabled]="(nPage + 1) === 1">
            <a class="page-link" href="#" (click)="$event.preventDefault(); goToPrev()" aria-label="Página anterior">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>

          <li class="page-item" *ngFor="let pag of arrBotonera">
            @if (pag === '...') {
            <span class="page-link dots" aria-hidden="true">…</span>
            } @else {
            <a class="page-link" href="#" (click)="$event.preventDefault(); goToPage(+pag)"
              [class.active]="(nPage + 1) === +pag">
              {{ pag }}
            </a>
            }
          </li>

          <li class="page-item" [class.disabled]="(nPage + 1) === (oPage?.totalPages || 0)">
            <a class="page-link" href="#" (click)="$event.preventDefault(); goToNext()" aria-label="Página siguiente">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>

        </ul>
      </nav>

    </div>
  </section>

</div>