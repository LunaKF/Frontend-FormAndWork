<div class="page soft-bg">

  <!-- Header / Toolbar -->
  <header class="header-ofertas">
    <div class="container-xl">
      <div class="toolbar">
        <div class="title-group">
          <h1 class="title-gradient">Empresas</h1>
          <p class="subtitle">Explora el tejido empresarial del ecosistema FormAndWork.</p>
        </div>

        <div class="tools">
          <div class="searchbox">
            <i class="bi bi-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Buscar por nombre, email o ID…"
              [(ngModel)]="strFiltro"
              (keyup)="filter()"
              aria-label="Buscar empresas"
            />
          </div>

          <!-- RPP pills (múltiplos de 6: 12 / 24 / 36) -->
          <div class="btn-group rpp-pills" role="group" aria-label="Resultados por página">
            <button type="button" class="btn" [class.active]="nRpp === 12" (click)="goToRpp(12)">12</button>
            <button type="button" class="btn" [class.active]="nRpp === 24" (click)="goToRpp(24)">24</button>
            <button type="button" class="btn" [class.active]="nRpp === 36" (click)="goToRpp(36)">36</button>
          </div>
        </div>
      </div>

      <!-- Chips -->
      <div class="chips">
        <span class="chip" [class.chip-muted]="!(strFiltro.length>0)">
          <i class="bi bi-funnel"></i>
          @if (strFiltro.length>0) { Filtro: <strong class="text-danger">{{ strFiltro }}</strong> } @else { Sin filtro }
        </span>

        <span class="chip">
          <i class="bi bi-collection"></i>
          Mostrando {{ oPage?.numberOfElements || 0 | number:'1.0-0' }} de {{ oPage?.totalElements || 0 | number:'1.0-0' }}
        </span>
      </div>
    </div>
  </header>

  <!-- Grid de tarjetas -->
  <section class="companies-grid">
    <div class="container-xl">
      <div class="grid">

        <!-- Skeleton -->
        <ng-container *ngIf="loading">
          <article class="company-card skeleton" *ngFor="let i of [1,2,3,4,5,6]">
            <div class="avatar sk"></div>
            <div class="sk-line"></div>
            <div class="sk-line short"></div>
          </article>
        </ng-container>

        <!-- Tarjetas -->
        <article
          class="company-card hover-rise"
          *ngFor="let empresa of oPage?.content; trackBy: trackById"
          tabindex="0"
          (click)="view(empresa)"
          (keydown.enter)="view(empresa)"
          [attr.aria-label]="'Abrir detalle de ' + (empresa?.nombre || '')"
        >
          <!-- header: avatar + nombre -->
          <div class="card-head">
            <div class="avatar" aria-hidden="true">
              <span>{{ (empresa.nombre | trim: 2) }}</span>
            </div>

            <div class="head-text">
              <h2 class="company-name">{{ empresa.nombre }}</h2>

              <div class="meta-line">
                <span *ngIf="isAdmin" class="badge-id">#{{ empresa.id }}</span>
                <span class="pill-sec">
                  <i class="bi bi-diagram-3"></i> {{ empresa.sector?.nombre }}
                </span>
              </div>
            </div>
          </div>

          <!-- email -->
          <div class="email small">
            <i class="bi bi-envelope"></i> {{ empresa.email }}
          </div>

          <!-- stats / acciones -->
          <div class="stats">
            <a
              class="pill"
              [class.disabled]="!(empresa.ofertas>0)"
              [routerLink]="['/admin','oferta','xempresa','plist', empresa.id]"
              aria-label="Ver ofertas de la empresa"
              (click)="$event.stopPropagation()"
            >
              <i class="bi bi-briefcase"></i> Ofertas <strong>{{ empresa.ofertas || 0 }}</strong>
            </a>
          </div>

          <div class="actions" *ngIf="isAdmin">
            <!-- Eliminamos el botón 'Ver' -->
            <button class="btn btn-light lift" type="button" (click)="$event.stopPropagation(); edit(empresa)">
              <i class="bi bi-pen"></i> Editar
            </button>
            <button class="btn btn-light danger lift" type="button" (click)="$event.stopPropagation(); remove(empresa)">
              <i class="bi bi-trash"></i> Eliminar
            </button>
          </div>
        </article>

        <!-- Vacío -->
        <div class="empty" *ngIf="!loading && (oPage?.content?.length||0)===0">
          <i class="bi bi-emoji-neutral"></i>
          <p>No hay empresas que coincidan.</p>
        </div>
      </div>

      <!-- Paginación ultra moderna -->
      <nav class="my-3" aria-label="Paginación" *ngIf="hasMultiplePages()">
        <ul class="pagination justify-content-center flex-wrap">
          <li class="page-item" [class.disabled]="(nPage + 1) === 1">
            <a class="page-link arrow prev" href="#" (click)="goToPrev()" [attr.aria-label]="'Página anterior'">
              <span class="arrow-shaft"></span>
            </a>
          </li>

          <li class="page-item" *ngFor="let pag of arrBotonera">
            @if (pag === '...') {
              <span class="page-link dots" aria-hidden="true">…</span>
            } @else {
              <a
                class="page-link"
                href="#"
                (click)="goToPage(+pag)"
                [class.active]="(nPage + 1) === +pag"
              >{{ pag }}</a>
            }
          </li>

          <li class="page-item" [class.disabled]="(nPage + 1) === (oPage?.totalPages || 0)">
            <a class="page-link arrow next" href="#" (click)="goToNext()" [attr.aria-label]="'Página siguiente'">
              <span class="arrow-shaft"></span>
            </a>
          </li>
        </ul>
      </nav>

    </div>
  </section>
</div>
