<div class="delete-page">
  <div class="container-xl py-4">

    <div class="delete-card">

      <div class="delete-head">
        <div class="delete-icon">
          <i class="bi bi-trash3"></i>
        </div>

        <div>
          <h1 class="delete-title">Confirmar eliminación de candidatura</h1>

          <!-- subtítulo distinto por rol -->
          <p class="delete-subtitle" *ngIf="isAlumno">
            ¿Seguro que quieres eliminar tu candidatura? La empresa ya no podrá contactarte para esta oferta.
          </p>

          <p class="delete-subtitle" *ngIf="isAdmin">
            Estás a punto de eliminar una candidatura del sistema. Revisa los datos antes de confirmar.
          </p>
        </div>
      </div>

      <hr class="delete-sep" />

      <!-- loading -->
      <div class="loading-state" *ngIf="loading">
        <div class="spinner-border"></div>
        <p>Cargando candidatura…</p>
      </div>

      <!-- contenido -->
      <ng-container *ngIf="!loading && oCandidatura as c">

        <div class="info-grid">

          <!-- ID (admin y alumno pueden verlo, no dijiste que el alumno no pueda ver el id de candidatura) -->
          <div class="info-item">
            <div class="info-label">Candidatura</div>
            <div class="info-value">#{{ c.id }}</div>
          </div>

          <!-- FECHA candidatura -->
          <div class="info-item">
            <div class="info-label">Fecha</div>
            <div class="info-value">
              <i class="bi bi-calendar-event"></i>
              {{ c.fecha | date:'dd/MM/yyyy HH:mm' }}
            </div>
          </div>

          <!-- DATOS ALUMNO: SOLO ADMIN -->
          <div class="info-item wide" *ngIf="isAdmin">
            <div class="info-label">Alumno</div>
            <div class="info-value">
              <i class="bi bi-person"></i>
              {{ fullName(c.alumno) }}
              <span class="muted" *ngIf="c.alumno?.id">(#{{ c.alumno?.id }})</span>
              <div class="muted" *ngIf="c.alumno?.email">
                <i class="bi bi-envelope"></i> {{ c.alumno?.email }}
              </div>
            </div>
          </div>

          <!-- OFERTA (admin+alumno): titulo + descripcion -->
          <div class="info-item">
            <div class="info-label">Oferta</div>
            <div class="info-value">
              <i class="bi bi-briefcase"></i>
              {{ c.oferta?.titulo || '—' }}
              <span class="muted" *ngIf="isAdmin && c.oferta?.id">(#{{ c.oferta?.id }})</span>
            </div>
          </div>

          <div class="info-item wide">
            <div class="info-label">Descripción de la oferta</div>
            <div class="info-value">
              {{ c.oferta?.descripcion || '—' }}
            </div>
          </div>

          <!-- EMPRESA (admin+alumno): nombre + email -->
          <div class="info-item">
            <div class="info-label">Empresa</div>
            <div class="info-value">
              <i class="bi bi-building"></i>
              {{ c.oferta?.empresa?.nombre || '—' }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">Email empresa</div>
            <div class="info-value">
              <i class="bi bi-envelope"></i>
              {{ c.oferta?.empresa?.email || '—' }}
            </div>
          </div>

          <!-- SECTOR -->
          <div class="info-item">
            <div class="info-label">Sector</div>
            <div class="info-value">
              <i class="bi bi-diagram-3"></i>
              {{ c.oferta?.sector?.nombre || '—' }}
            </div>
          </div>
        </div>

        <!-- warning -->
        <div class="warning-box" *ngIf="isAlumno">
          <i class="bi bi-exclamation-triangle"></i>
          <div>
            <p class="m-0">
              <strong>Confirmación:</strong> si borras tu candidatura, la empresa
              <strong>"{{ c.oferta?.empresa?.nombre || '—' }}"</strong>
              ya no podrá contactarte para la oferta
              <strong>"{{ c.oferta?.titulo || '—' }}"</strong>.
            </p>
            <small>Podrás volver a postular si la oferta sigue activa (si tu sistema lo permite).</small>
          </div>
        </div>

        <div class="warning-box" *ngIf="isAdmin">
          <i class="bi bi-exclamation-triangle"></i>
          <div>
            <p class="m-0">
              <strong>Atención:</strong> vas a eliminar una candidatura.
              Verifica que es la correcta antes de confirmar.
            </p>
            <small>Esta acción no se puede deshacer.</small>
          </div>
        </div>

        <!-- acciones -->
        <div class="actions-row">
          <button class="btnx btn-ghost" [routerLink]="['/admin','candidatura','plist']">
            <i class="bi bi-arrow-left"></i>
            Volver
          </button>

          <div class="actions-right">
            <!-- botones extra -->
            <button class="btnx btn-secondary" (click)="goToOferta()" *ngIf="c.oferta?.id">
              <i class="bi bi-box-arrow-up-right"></i>
              Ver oferta
            </button>

            <button class="btnx btn-secondary" (click)="goToEmpresa()" *ngIf="c.oferta?.empresa?.id">
              <i class="bi bi-building"></i>
              Ver empresa
            </button>

            <!-- borrar -->
            <button class="btnx btn-danger" (click)="delete()" [disabled]="deleting">
              <span *ngIf="!deleting">
                <i class="bi bi-trash"></i>
                Eliminar candidatura
              </span>
              <span *ngIf="deleting">
                <span class="spinner-border spinner-border-sm"></span>
                Eliminando…
              </span>
            </button>
          </div>
        </div>

      </ng-container>

    </div>
  </div>
</div>

<!-- modal -->
<div class="modal fade" id="mimodal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <button class="btn-close" (click)="hideModal()"></button>
      </div>

      <div class="modal-body">
        <p>{{ strMessage }}</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-primary" (click)="hideModal()">Cerrar</button>
      </div>

    </div>
  </div>
</div>
